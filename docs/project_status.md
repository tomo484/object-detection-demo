# メーター針検出・数値読取システム 進捗報告

## 📊 現状できていること

### 1. 物体検出・キーポイント検出
- ✅ **針の検出**: mAP50 = 99.5%、mAP50-95 = 87.1%
- ✅ **キーポイント検出**: mAP50 = 99.5%、mAP50-95 = 91.0%
- ✅ **pivot（回転軸）とtip（先端）の両方を高精度で検出**
- ✅ **検出信頼度**: 全テスト画像で100%の有効率（conf ≥ 0.5）

### 2. モデル学習
- ✅ **YOLOv8n-poseでの学習完了**: 30エポック、適切な収束
- ✅ **学習データ**: train=28枚、val=8枚、test=4枚（7:2:1の理想比率）
- ✅ **重みファイル保存**: `runs/pose/train3/weights/best.pt`

### 3. 角度評価システム
- ✅ **角度MAE評価スクリプト**: `scripts/eval_angle_mae.py`
- ✅ **可視化機能**: GT（緑）と予測（マゼンタ）の矢印表示
- ✅ **結果出力**: CSV、JSON、可視化画像の自動生成

### 4. 技術的基盤
- ✅ **YOLO Pose形式**: データセット構成とラベル形式
- ✅ **角度計算アルゴリズム**: 画像座標系での正確な角度算出
- ✅ **評価指標**: 円周上の最短差による角度誤差測定

## ❌ 現状できていないこと

### 1. 角度精度
- ❌ **角度MAE**: 現在48.26°（目標: ≤3°）
- ❌ **pivot位置精度**: 2-3ピクセルのずれが30-50°の角度誤差に拡大
- ❌ **外れ値**: 特定画像で92°の大きな誤差

### 2. 値変換システム
- ❌ **角度→数値変換**: 実装中（gauge_config.yaml設定済み）
- ❌ **値MAE評価**: スクリプトは準備済みだが未実行
- ❌ **メーター機種対応**: SKU別の仕様管理システム未構築

### 3. 実用システム化
- ❌ **API化**: エンドユーザー向けインターフェース未実装
- ❌ **バッチ処理**: 複数画像の一括処理機能
- ❌ **エラーハンドリング**: 異常画像・未検出時の処理

## 🎯 課題

### 1. 精度改善（最優先）
**課題**: 角度MAE 48° → 目標3°以内への改善
- **原因**: pivot位置の微小誤差（2-3ピクセル）が角度誤差に拡大
- **解決策**: データ量増加（train 28枚 → 98枚を段階的に実施）
- **期待効果**: MAE 48° → 10-15° → 3-5°

### 2. データ不足
**課題**: 学習データが40枚と極小規模
- **影響**: 汎化性能不足、pivot位置の学習不安定
- **計画**: 
  - Phase1: 70枚（train+21枚）→ MAE 25-30°
  - Phase2: 140枚（train+70枚）→ MAE 10-15°
  - Phase3: 210枚（train+119枚）→ MAE 3-5°

### 3. アノテーション品質
**課題**: pivot位置の一貫性不足
- **問題**: アノテーター間でpivot基準がばらつく
- **対策**: 
  - ガイド円を使用した精密アノテーション
  - アノテーションガイドライン策定
  - 複数人による相互チェック

### 4. 機種対応の拡張性
**課題**: 複数メーター機種への対応設計
- **現状**: 単一設定ファイルでの固定仕様
- **必要**: SKU別仕様管理システム
- **要素**:
  - 角度範囲（theta_min, theta_max）
  - 値範囲（v_min, v_max）
  - 回転方向（CW/CCW）

### 5. 評価の信頼性
**課題**: テストデータ4枚では統計的に不安定
- **必要**: test=15-20枚での評価
- **目的**: 真の性能把握、改善効果の定量化

## 📈 今後の優先順位

### Phase 1（短期: 1-2週間）
1. **データ収集**: train+21枚の追加撮影・アノテーション
2. **再学習・評価**: MAE改善効果の確認
3. **値MAE実装**: 実用性評価の開始

### Phase 2（中期: 1ヶ月）
4. **更なるデータ増加**: train=98枚まで拡張
5. **アノテーション品質向上**: ガイドライン策定・相互チェック
6. **機種対応設計**: SKU管理システムの基盤構築

### Phase 3（長期: 2-3ヶ月）
7. **実用システム化**: API化・バッチ処理対応
8. **運用テスト**: 実環境での性能検証
9. **保守・拡張**: 新機種対応・継続改善

## 🎯 成功指標

### 技術指標
- **角度MAE**: ≤3° （現在: 48°）
- **値MAE**: ≤2-3単位
- **検出成功率**: ≥95%

### 実用指標
- **処理速度**: <200ms/画像
- **機種対応**: 3種類以上
- **運用安定性**: 連続1000枚処理での異常停止0件

---
*最終更新: 2024年12月*
*プロジェクト責任者: [担当者名]* 